<!DOCTYPE html>
  <html lang='en'>
    <head>
      <meta charset='utf-8'>
      <meta name='viewport' content='width=device-width, initial-scale=1'>
      <title>Admin Tareas</title> 

      <style>
        #session-modal {
          position: fixed;
          top: 0; left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0,0,0,0.6);
          display: none !important;
          align-items: center;
          justify-content: center;
          z-index: 9999;
        }

        #session-modal.active {
          display: flex !important;
        }

        #session-modal .modal-content {
          background: white;
          padding: 2rem;
          border-radius: 10px;
          text-align: center;
          max-width: 400px;
          box-shadow: 0 0 10px rgba(0,0,0,0.4);
        }

        #session-modal button {
          margin: 1rem;
          padding: 0.5rem 1rem;
          font-size: 16px;
        }

        #expired-modal {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: none !important;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }

      #expired-modal.active {
        display: flex !important;
      }

      #expired-modal .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        text-align: center;
        max-width: 400px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
      }

      #expired-modal button {
        margin: 1rem;
        padding: 0.5rem 1rem;
        font-size: 16px;
      }
      </style>

      <link href='https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap' rel='stylesheet'>
      <link rel='stylesheet' href='/pages/css/styles.css'>
      <link rel='stylesheet' href='plugins/fontawesome-free/css/all.min.css'> 
      <link rel='stylesheet' href='https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css'> 
      <link rel='stylesheet' href='plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css'> 
      <link rel='stylesheet' href='plugins/icheck-bootstrap/icheck-bootstrap.min.css'> 
      <link rel='stylesheet' href='plugins/jqvmap/jqvmap.min.css'> 
      <link rel='stylesheet' href='dist/css/adminlte.min.css'> 
      <link rel='stylesheet' href='plugins/overlayScrollbars/css/OverlayScrollbars.min.css'> 
      <link rel='stylesheet' href='plugins/daterangepicker/daterangepicker.css'> 
      <link rel='stylesheet' href='/plugins/select2/css/select2.min.css'>
      <link rel='stylesheet' href='/plugins/summernote/summernote-bs4.min.css'> 
      <script src='https://use.fontawesome.com/releases/v6.3.0/js/all.js' crossorigin='anonymous'></script>
    </head>

    <body class='hold-transition sidebar-mini layout-fixed'> 
      <div id="session-modal">
        <div class="modal-content">
          <p>¿Sigues ahí?</p>
          <button id="stay-btn">Sí</button>
          <button id="logout-btn">No</button>
        </div>
      </div>

      <div id="expired-modal">
        <div class="modal-content">
          <p>❌ Tu sesión ha expirado por inactividad.</p>
          <button id="expired-ok-btn">Aceptar</button>
        </div>
      </div>

      <div class='wrapper'> 
        <div id='loaderContainer' class='loader-overlay'>
          <div class='loader'></div>
        </div>
      
        <nav class='main-header navbar navbar-expand navbar-white navbar-light'>
          <ul class='navbar-nav'>
            <li class='nav-item'>
              <a class='nav-link' data-widget='pushmenu' href='#' role='button'><i class='fas fa-bars'></i></a>
            </li>
            <li class='nav-item d-none d-sm-inline-block'>
              <a href='index.html' class='nav-link'>Home</a>
            </li> 
          </ul>
        </nav>
        <div id='sidebar-placeholder'></div> 
        <div class='content-wrapper'> 
          <div class='content-header'>
            <div class='container-fluid'>
              <div class='row mb-2'>
                <div class='col-sm-6'>
                  <h1 class='m-0'>Dashboard</h1>
                </div> 
                <div class='col-sm-6'>
                  <ol class='breadcrumb float-sm-right'>
                    <li class='breadcrumb-item'><a href='#'>Inicio</a></li>
                    <li class='breadcrumb-item active'>Dashboard</li>
                  </ol>
                </div> 
              </div> 
            </div> 
          </div> 
          <section class='content mt-3 fadeInUp-animation'>
            <div class='container-fluid '> 
              <div class='row'>
                <div class='col-xl-3 col-md-6 col-12 mb-3'>
                  <div class='small-box bg-info' id='card-proyectos' onclick='guardarTabActivo("/index.html"); mostrarContenido("proyectos")' style='cursor: pointer;'>
                    <div class='inner'>
                      <h3>10</h3>
                      <p>Proyectos</p>
                    </div>
                    <div class='icon'>
                      <i class='fas fa-diagram-project'></i>
                    </div>
                    <a href='#' class='small-box-footer'>Más información <i class='fas fa-arrow-circle-down'></i></a>
                  </div>
                </div>
                <div class='col-xl-3 col-md-6 col-12 mb-3'>
                  <div class='small-box bg-warning' id='card-tareas' onclick='mostrarContenido("tareas")' style='color: white !important; cursor: pointer;'>
                    <div class='inner'>
                      <h3>53</h3>
                      <p>Tareas Pendientes</p>
                    </div>
                    <div class='icon'>
                      <i class='fas fa-list-check'></i>
                    </div>
                    <a href='#' class='small-box-footer' style='color: white !important;'>Más información <i class='fas fa-arrow-circle-down'></i></a>
                  </div>
                </div>
                <div class='col-xl-3 col-md-6 col-12 mb-3'>
                  <div class='small-box bg-success' id='card-todos' onclick='mostrarContenido("todos")' style='color: white; cursor: pointer;'>
                    <div class='inner'>
                      <h3>44</h3>
                      <p>Todos los Proyectos</p>
                    </div>
                    <div class='icon'>
                      <i class='fas fa-diagram-project'></i>
                    </div>
                    <a href='#' class='small-box-footer'>Más información <i class='fas fa-arrow-circle-down'></i></a>
                  </div>
                </div>

                <div class='col-xl-3 col-md-6 col-12 mb-3' >
                  <div class='small-box bg-danger' id='card-aprobaciones' onclick='mostrarContenido("aprobaciones")' style='cursor: pointer;'>
                    <div class='inner'>
                      <h3>15</h3>
                      <p>Aprobaciones Pendientes</p>
                    </div>
                    <div class='icon'>
                      <i class='fas fa-list-check'></i>
                    </div>
                    <a href='#' class='small-box-footer'>Más información <i class='fas fa-arrow-circle-down'></i></a>
                  </div>
                </div>
              </div> 
            </div> 
          </section> 
          <section class='content fadeInUp-animation'> 
            <div id='dashboard-content' class='mt-4 ml-2 mr-2'> 
      
            </div> 
          </section>
        </div> 
        <footer class='main-footer'>
          <strong>Cartonajes Bernabeú.</strong>
        </footer>
      </div>
  
      <script src='plugins/jquery/jquery.min.js'></script> 
      <script src='plugins/jquery-ui/jquery-ui.min.js'></script>  

      <script src='plugins/bootstrap/js/bootstrap.bundle.min.js'></script> 
      <script src='plugins/moment/moment.min.js'></script>
      <script src='plugins/daterangepicker/daterangepicker.js'></script>
      <script src='plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js'></script>
      <script src='plugins/summernote/summernote-bs4.min.js'></script>
      <script src='plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js'></script>
    
      <script src='dist/js/adminlte.js'></script> 
      <script src='/plugins/select2/js/select2.full.js'></script>
      <script src='/pages/js/scripts.js'></script>
      <link   href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr' crossorigin='anonymous'>
      <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js' integrity='sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q' crossorigin='anonymous'></script>
  
      <script>
        $.widget.bridge('uibutton', $.ui.button)    

        // // Tiempo máximo de inactividad antes de mostrar el modal (30 segundos)
        // const LIMITE_INACTIVIDAD = 30000;

        // // Tiempo que tiene el usuario para responder al modal (10 segundos)
        // const TIEMPO_MODAL = 10000;

        // // ID único para identificar esta pestaña
        // const idPestania = Date.now().toString() + Math.random().toString(36).slice(2);

        // // Claves para localStorage que se comparten entre pestañas
        // const CLAVE_LIDER = 'pestania-activa';
        // const CLAVE_SESION_EXPIRADA = 'sesion-expirada';
        // const CLAVE_MODAL_VISIBLE = 'modal-visible';
        // const CLAVE_MODAL_RESPUESTA = 'modal-respuesta';

        // // Estado de la pestaña
        // let esLider = false;
        // let sesionExpirada = false;

        // // Temporizadores
        // let temporizadorInactividad;
        // let temporizadorModal;
        // let intervaloCronometro;
        // let segundosInactivo = 0;

        // // Referencias al DOM
        // const modalInactividad = document.getElementById('session-modal');
        // const botonSeguir = document.getElementById('stay-btn');
        // const botonSalir = document.getElementById('logout-btn');

        // // 🔔 Mostrar modal de inactividad en esta pestaña
        // function mostrarModal() {
        //   modalInactividad.classList.add('active');
        //   localStorage.setItem(CLAVE_MODAL_VISIBLE, Date.now().toString());

        //   temporizadorModal = setTimeout(() => {
        //     expirarSesion();
        //   }, TIEMPO_MODAL);
        // }

        // // 🧹 Ocultar modal en esta pestaña
        // function ocultarModal() {
        //   modalInactividad.classList.remove('active');
        //   clearTimeout(temporizadorModal);
        //   clearInterval(intervaloCronometro);
        // }

        // // 🔁 Reiniciar contador de inactividad
        // function reiniciarContadorInactividad() {
        //   if (!esLider || sesionExpirada) return;

        //   clearTimeout(temporizadorInactividad);
        //   clearInterval(intervaloCronometro);
        //   segundosInactivo = 0;

        //   console.log(`[${new Date().toLocaleTimeString()}] 🔄 Temporizador reiniciado`);

        //   intervaloCronometro = setInterval(() => {
        //     segundosInactivo++;
        //     console.log(`🕒 Inactividad: ${segundosInactivo}s...`);
        //   }, 1000);

        //   temporizadorInactividad = setTimeout(() => {
        //     clearInterval(intervaloCronometro);
        //     console.log(`[${new Date().toLocaleTimeString()}] ⏰ Mostrando modal de inactividad`);
        //     mostrarModal();
        //   }, LIMITE_INACTIVIDAD);
        // }

        // // ❌ Expirar sesión y notificar a otras pestañas
        // function expirarSesion() {
        //   if (sesionExpirada) return;
        //   sesionExpirada = true;
        //   esLider = false;
        //   ocultarModal();
        //   console.log(`[${new Date().toLocaleTimeString()}] ❌ SESIÓN EXPIRADA`);
        //   localStorage.setItem(CLAVE_SESION_EXPIRADA, Date.now().toString());
        // }

        // // ✅ Esta pestaña toma el liderazgo
        // function convertirEnLider() {
        //   localStorage.setItem(CLAVE_LIDER, idPestania);
        // }

        // // 🔍 Verifica si esta pestaña es la líder actual
        // function verificarLiderazgo() {
        //   const liderActual = localStorage.getItem(CLAVE_LIDER);
        //   if (liderActual === idPestania) {
        //     esLider = true;
        //     sesionExpirada = false;
        //     console.log(`[${new Date().toLocaleTimeString()}] ✅ Esta pestaña es la líder`);
        //     reiniciarContadorInactividad();
        //   } else {
        //     esLider = false;
        //     clearTimeout(temporizadorInactividad);
        //     clearInterval(intervaloCronometro);
        //     ocultarModal();
        //     console.log(`[${new Date().toLocaleTimeString()}] ❌ Esta pestaña no es líder`);
        //   }
        // }

        // // 📦 Escucha eventos de otras pestañas
        // window.addEventListener('storage', (evento) => {
        //   if (evento.key === CLAVE_LIDER) {
        //     verificarLiderazgo();
        //   }

        //   if (evento.key === CLAVE_SESION_EXPIRADA) {
        //     if (!sesionExpirada) {
        //       sesionExpirada = true;
        //       clearInterval(intervaloCronometro);
        //       ocultarModal();
        //       console.log(`[${new Date().toLocaleTimeString()}] ❌ SESIÓN EXPIRADA (notificada por otra pestaña)`);
        //     }
        //   }

        //   if (evento.key === CLAVE_MODAL_VISIBLE) {
        //     if (!sesionExpirada) {
        //       modalInactividad.classList.add('active');
        //       console.log(`[${new Date().toLocaleTimeString()}] ⚠️ Modal mostrado por evento de otra pestaña`);
        //     }
        //   }

        //   if (evento.key === CLAVE_MODAL_RESPUESTA) {
        //     if (!sesionExpirada) {
        //       ocultarModal();
        //       console.log(`[${new Date().toLocaleTimeString()}] 🧹 Modal ocultado por respuesta en otra pestaña`);
        //     }
        //   }
        // });

        // // ▶️ Evento: el usuario hace clic en "Sí"
        // botonSeguir.addEventListener('click', () => {
        //   console.log(`[${new Date().toLocaleTimeString()}] ✅ Usuario sigue activo`);
        //   ocultarModal();
        //   localStorage.setItem(CLAVE_MODAL_RESPUESTA, Date.now().toString());
        //   reiniciarContadorInactividad();
        // });

        // // ▶️ Evento: el usuario hace clic en "No"
        // botonSalir.addEventListener('click', () => {
        //   expirarSesion();
        // });

        // // 🎯 Detectar actividad del usuario en esta pestaña
        // ['mousemove', 'keydown', 'click'].forEach(evento =>
        //   window.addEventListener(evento, () => {
        //     if (esLider && !sesionExpirada) {
        //       reiniciarContadorInactividad();
        //     }
        //   })
        // );

        // // 🟢 Al cargar, intentar convertirse en líder
        // setTimeout(() => {
        //   convertirEnLider();
        //   verificarLiderazgo();
        // }, 100);

        // // 🚪 Si se cierra la pestaña, liberar el liderazgo si lo tenía
        // window.addEventListener('beforeunload', () => {
        //   const liderActual = localStorage.getItem(CLAVE_LIDER);
        //   if (liderActual === idPestania) {
        //     localStorage.removeItem(CLAVE_LIDER);
        //   }
        // });

        // // 👀 Cambiar de líder al enfocar esta pestaña (visibilidad)
        // document.addEventListener('visibilitychange', () => {
        //   if (document.visibilityState === 'visible' && !sesionExpirada) {
        //     console.log(`[${new Date().toLocaleTimeString()}] 👀 Pestaña activa. Solicitando liderazgo...`);
        //     convertirEnLider();
        //     verificarLiderazgo();
        //     reiniciarContadorInactividad();
        //   }
        // });

      </script>
    </body>
  </html>
